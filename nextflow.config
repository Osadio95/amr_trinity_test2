//
// AMR Trinity Workflow Configuration
//

params {
    // Input/output
    input = 'test/mini/isolates.tsv'
    outdir = 'results'
    
    // AMR analysis
    threads = 4
    skip_amrfinder = false
    skip_resfinder = false
    skip_rgi = false
    
    // Generic
    help = false
    version = false
    monochrome_logs = false
    validate_params = true
    show_hidden_params = false
}

manifest {
    name            = 'AMR Trinity'
    author          = 'Seqafrica'
    homePage        = 'https://github.com/Osadio95/AMR_trinity_test'
    description     = 'Antimicrobial resistance detection using AMRFinderPlus, ResFinder and RGI with harmonization'
    mainScript      = 'main.nf'
    nextflowVersion = '>=20.10.0'
    version         = '1.0.11'
}

// Process configuration
process {
    shell = ['/bin/bash', '-euo', 'pipefail']
    
    withName:'amrfinderplus' {
        container = 'docker.io/ncbi/amr:4.0.23-2025-07-16.1'
        cpus = { check_max( params.threads ?: 4, 8 ) }
    }
    
    withName:'resfinder' {
        container = 'docker.io/genomicepidemiology/resfinder:4.7.2'
        containerOptions = '--entrypoint ""'
        cpus = { check_max( params.threads ?: 4, 8 ) }
    }
    
    withName:'rgi' {
        container = 'quay.io/biocontainers/rgi:6.0.5--pyh05ac1d_0'
        cpus = { check_max( params.threads ?: 4, 8 ) }
    }
    
    withName:'hamronize' {
        container = 'ghcr.io/zwets/hamronization:1.1.10'
        containerOptions = '--entrypoint ""'
        cpus = 1
    }
    
    withName:'summarise' {
        container = 'ghcr.io/zwets/hamronization:1.1.10'
        containerOptions = '--entrypoint ""'
        cpus = 1
    }
}

def check_max( val, max ) {
    return val <= max ? val : max
}

// Profiles
profiles {
    standard {
        docker {
            enabled = true
            runOptions = "--user \$(id -u):\$(id -g) --group-add 100"
        }
    }
    
    singularity {
        singularity {
            enabled = true
            autoMounts = true
        }
    }
    
    local {
        process.executor = 'local'
    }
}

// Reporting
timeline {
    enabled = true
    file = "${params.outdir}/pipeline_info/timeline.html"
}

report {
    enabled = true
    file = "${params.outdir}/pipeline_info/report.html"
}

trace {
    enabled = true
    file = "${params.outdir}/pipeline_info/trace.txt"
}
